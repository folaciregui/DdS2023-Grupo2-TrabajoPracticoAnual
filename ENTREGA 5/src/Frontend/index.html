<!DOCTYPE html>
<html>
<head>
    <title>Iniciar Sesión</title>
</head>
<body>
<h1>Iniciar Sesión</h1>
<div id="login-form">
    <h1>REGISTRARSE</h1>
    <input type="email" id="emailRegister" placeholder="Correo Electrónico">
    <input type="password" id="passwordRegister" placeholder="Contraseña">
    <button onclick="register()">Registrarse</button>
    <h1>LOGUEARSE</h1>
    <input type="email" id="emailLogin" placeholder="Correo Electrónico">
    <input type="password" id="passwordLogin" placeholder="Contraseña">
    <button onclick="login()">Iniciar Sesión</button>
    <h1 id="userState"></h1>

</div>

<div id="user-info" style="display: none;">
    <p>Bienvenido, <span id="user-displayname"></span> (Estado email:<span id="user-email"></span> :<span id="texto-verificado"></span>)</p>
    <button onclick="logout()">Cerrar Sesión</button>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
<!-- ... Otros scripts de Firebase, como storage, messaging, functions, y analytics, si los necesitas ... -->

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyCqXg0sZXtSOxHPEjkKKS0S4jdHER1z-VU",
        authDomain: "dds-sistema-monitoreables.firebaseapp.com",
        projectId: "dds-sistema-monitoreables",
        storageBucket: "dds-sistema-monitoreables.appspot.com",
        messagingSenderId: "625925036616",
        appId: "1:625925036616:web:8a61a46d81a4c752b9167d"
    };

    // Inicializa Firebase
    firebase.initializeApp(firebaseConfig);
    // Verifica estado de sesion
    firebase.auth().onAuthStateChanged((user) => {
        if (user) {
            // User is signed in, see docs for a list of available properties
            var uid = user.uid;
            var textoVerificado="";
            document.getElementById("userState").innerHTML="Hizo login"
            console.log(user);//para ver datos de usuario, despues borrar esta linea
            if(user.emailVerified){
                textoVerificado="Estas verificado";
            }else {
                textoVerificado="No estas verificado"
            }
            document.getElementById("texto-verificado").textContent = textoVerificado;
        } else {
            // User is signed out
            document.getElementById("userState").innerHTML="Deslogueado"

        }
    });

    // Referencias a elementos HTML
    const loginForm = document.getElementById("login-form");
    const userInfo = document.getElementById("user-info");
    const userDisplayName = document.getElementById("user-displayname");
    const userEmail = document.getElementById("user-email");

    // Función para registarse
    function register(){
        const email = document.getElementById("emailRegister").value;
        const password = document.getElementById("passwordRegister").value;
        firebase.auth().createUserWithEmailAndPassword(email, password)
            .catch(function(error){
                var errorCode = error.code;
                var errorMessage = error.message;
                alert(errorMessage);
            })
            .then(function (){
                verificarCorreo()
            })
    }
    // Función para iniciar sesión
    function verificarCorreo(){
        var user = firebase.auth().currentUser;
        user.sendEmailVerification().then(function (){
            //Email mandado
        }).catch(function (error){
            // Hubo algun error, manejarlo
        })
    }
    function login() {
        const email = document.getElementById("emailLogin").value;
        const password = document.getElementById("passwordLogin").value;
        alert("el email es: " + email + " y la password es: " + password);

        firebase.auth().signInWithEmailAndPassword(email, password)
            .then((userCredential) => {
                const user = userCredential.user;
                loginForm.style.display = "none";
                userInfo.style.display = "block";
                userDisplayName.innerText = user.displayName;
                userEmail.innerText = user.email;
            })
            .catch((error) => {
                alert("Error al iniciar sesión: " + error.message);
            });
    }

    // Función para cerrar sesión
    function logout() {
        firebase.auth().signOut().then(() => {
            loginForm.style.display = "block";
            userInfo.style.display = "none";
        }).catch((error) => {
            alert("Error al cerrar sesión: " + error.message);
        });
    }
</script>
</body>
</html>
